<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Hanya: <?=I18n::_("system.filemanager.title")?></title>
		{tag:head()}
		<link rel="stylesheet" href="assets/system/stylesheets/hanya.admin.css" type="text/css" media="screen">
		<style type="text/css" media="screen">
		
			.wrapper .hint {
				margin-top: 10px;
				color: #888;
			}
		
			#navigator {
				background-color: white;
				padding: 15px 20px;
				border: 1px solid #ddd;
			}

			#navigator ul ul li {
				padding-left: 10px;
			}

			#navigator li a {
				display: block;
				background: url(assets/system/images/directory-closed.png) 0 center no-repeat;
				padding: 3px;
				padding-left: 20px;
				vertical-align: middle;
			}

			#navigator li#open > a {
				background-image: url(assets/system/images/directory-open.png	);
				font-weight: bold;
			}

			#navigator a {
				margin: 5px 0;
				height: 16px;
				color: inherit;
				text-decoration: none;
				font-weight: inherit;
			}

			#files {
				border: 1px solid #ddd;
				background-color: white;
			}

			#files table {
				width: 100%;
			}

			#files tr td {
				border-top: 1px solid #ddd;
				padding: 15px;
				vertical-align: middle;
			}
			
			#files tr:first-child td {
				border: 0;
			}

			#files tr td span.directory {
				display: none;
			}

			#files tr:hover td {
				background-color: #eee;
				cursor: pointer;
			}

			#files tr:hover td span.directory {
				display: inline;
			}

			#files .right {
				text-align: right;
			} 

			#files .delete {
				cursor: pointer;
			}

			#files p {
				padding: 15px;
			}

			#viewer {
				border: 1px solid #ddd;
				padding: 15px;
				background-color: white;
			}

			#viewer img {
				width: 100%;
			}

			#viewer table {
				width: 100%;
				margin-top: 10px;
			}
			
			#viewer table tr td, #viewer table tr th {
				padding: 5px;
				border-top: 1px solid #eee;
				border-bottom: 1px solid #eee;
			}
			
			#viewer table tr th {
				color: #666;
				border-right: 1px solid #ddd;
				text-align: right;
			}

			#create-directory {
				border: 1px solid #ddd;
				background-color: white;
			}
			
			#create-directory input {
				width: 98%;
				border: 0;
				margin: 0;
				padding: 6px;
				font-size: inherit;
				color: #888;
			}
			
			#create-directory input:focus {
				color: black;
			}
			
			#upload-file {
				border: 1px solid #ddd;
				background-color: #fff;
				padding: 6px;
			}
			
			#upload-file input {
			}
			
		</style>
		<script type="text/javascript" charset="utf-8">
			
			// On Startup
			$(document).ready(function(){
				
				// Delete Content of Inoput on Focus
				$("#create-directory input").focus(function(){
					$(this).val("");
				});
				
				// Rever to Normal on Blur
				$("#create-directory input").blur(function(){
					if($(this).val() == "") {
						$(this).val('<?=I18n::_("system.filemanager.new_directory")?>');
					}
				});
				
				// Add Click Handler
				$("#files tr").click(function(){
					$("#viewer").load("?command=filemanager_item&file="+$(this).data("item"));
				});
				
				// Add Click Handler
				$("#files tr img.delete").click(function(e){
					e.stopPropagation();
					if(confirm('<?=I18n::_("system.filemanager.confirm_delete_file")?>')) {
						var row = $(this).closest("tr");
						var file = row.data("item");
						$.ajax({
							type: "POST",
							data: { file : file },
							url: "?command=filemanager_delete_file",
							success: function(data) {
								if(data == "ok") {
									row.remove();
								}
							}
						});
					}
				});
				
				// Add Change Handler
				$("#upload-file input").change(function(){
					$(this).closest("form").submit();
				});
				
			});
			
		</script>
  </head>
  <body id="hanya-admin">
		<div class="hanya-toolbar" >
			<div class="hanya-toolbar-left" >
				<?=HTML::anchor(".",I18n::_("system.admin.back_to_site"))?>
			</div>
		</div>
		<h1><?=I18n::_("system.filemanager.title")?> (<?=$current_directory?>)</h1>
		<div class="wrapper">
			<div class="w1">
				<div id="navigator">
					<?=Filemanager_Plugin::directorys($current_directory)?>
				</div>
			</div>
			<div class="w2">
				<div id="files">
					<? if(count($content["."])): ?>
						<table>
							<? foreach($content["."] as $file) : ?>
								<tr data-item="<?=$current_directory."/".$file?>">
									<td width="1"><?=HTML::image(Url::_("assets/system/images/filetypes/".Disk::extension($file).".png"))?></td>
									<td><span class="directory"><?=$current_directory?>/</span><?=$file?></td>
									<td class="right"><?=Disk::filesize($current_directory."/".$file)?></td>
									<td width="1"><img class="delete" src="assets/system/images/cross.png" /></td>
								</tr>
							<? endforeach; ?>
						</table>
					<? else: ?>
						<p><?=I18n::_("system.filemanager.empty_directory")?></p>
					<? endif; ?>
				</div>
				<hr/>
				<h2><?=I18n::_("system.filemanager.upload_file")?></h2>
				<div id="upload-file">
					<form action="<?=URL::_("?command=filemanager_upload_file")?>" method="post" enctype="multipart/form-data">
						<input type="hidden" name="current_directory" value="<?=$current_directory?>" />
						<input type="file" name="new_file" />
					</form>
				</div>
				<p class="hint"><?=I18n::_("system.filemanager.upload_file_hint")?></p>
				<hr/>
				<h2><?=I18n::_("system.filemanager.create_directory")?></h2>
				<div id="create-directory">
					<form action="<?=URL::_("?command=filemanager_create_directory")?>" method="post">
						<input type="hidden" name="current_directory" value="<?=$current_directory?>" />
						<input type="text" name="new_directory" value="<?=I18n::_("system.filemanager.new_directory")?>" />
					</form>
				</div>
				<p class="hint"><?=I18n::_("system.filemanager.create_directory_hint")?></p>
			</div>
			<div class="w1-last">
				<div id="viewer">
					<p><?=I18n::_("system.filemanager.no_file_selected")?></p>
				</div>
			</div>
		</div>
  </body>
</html>